
<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, height=device-height, initial-scale=0.6, minimum-scale=0.6, maximum-scale=1.0, user-scalable=no" />
<link rel="icon" href="data:;base64,iVBORw0KGgo=">
<script src="https://cdnjs.cloudflare.com/ajax/libs/paper.js/0.12.15/paper-full.min.js"></script>
<style>
 input[type=range] {
  height: 50px;
  -webkit-appearance: none;
  width: 150px;
 }
 input[type=range]:focus {
  outline: none;
 }
 input[type=range]::-webkit-slider-runnable-track {
  width: 100%;
  height: 10px;
  cursor: pointer;
  animate: 0.2s;
  box-shadow: 1px 1px 1px #000000;
  background: #98b0ed;
  border-radius: 5px;
  border: 1px solid #000000;
 }
 input[type=range]::-webkit-slider-thumb {
   box-shadow: 1px 1px 1px #000000;
   border: 2px solid white;
   height: 43px;
   width: 25px;
   border-radius: 12px;
   background: #001280;
   cursor: pointer;
   -webkit-appearance: none;
   margin-top: -17.5px;
 }
 input[type=range]:focus::-webkit-slider-runnable-track {
  background: #707dcc;
 }
 input[type=range]::-moz-range-track {
  width: 100%;
  height: 10px;
  cursor: pointer;
  animate: 0.2s;
  box-shadow: 1px 1px 1px #000000;
  background: #98b0ed;
  border-radius: 5px;
  border: 1px solid #000000;
 }
 input[type=range]::-moz-range-thumb {
  box-shadow: 1px 1px 1px #000000;
  border: 1px solid #000000;
  height: 30px;
  width: 15px;
  border-radius: 5px;
  background: #001280;
  cursor: pointer;
 }
 button {
   background-color:#001280; 
   color: white;
   text-align: center;
   font-size: 25px;
   border-color:#001280;
 }
 button.button_disabled {
   background-color:#98b0ed; 
 }
 body {
   color: #001280;
   user-select: none;
   touch-action: none;
   -webkit-user-select: none;
   margin-left:0px;
   margin-right:0px;
   margin-top:5px;
 }
 dd {
   margin-left:10px;
   font-size: 25px;
 }
 div {
   text-align: center;
 }
 h1 {
   margin-top: 0px;
   margin-bottom: 0px;
 }
 label {
vertical-align: 15px;
 }
</style>
</head>
<body onload="setup()">
<div>
<h1>Aperiodic Tile Designer</h1>
<a href="https://www.tessellation.jp/aperiodic">www.tessellation.jp/aperiodic (Yoshi Araki)</a>
<dd><label>Shape:</label><input type="range" id="input_a" value="0.366025" min="0.05" max="0.95" step="0.01" onchange="draw()">
 <label>Rotate:</label><input type="range" id="input_rot" value="0" min="0" max="1" step="0.01" onchange="draw()">
</dd>
<p/>
<button onclick="setTile(0.366025)">(1,√3)</button>
<button onclick="setTile(0.4975)">(1,1.01)</button>
<button onclick="setTile(0.633975)">(√3,1)</button>
<button onclick="clearPaint()">clear</button>
<button id="button_download" disabled class="button_disabled" onclick="download()">download</button>
<a style="display:none;" id="a_download" download="download"></a>
<p/>
<div id="canvas_div">
<canvas id="canvas_draw" width="600" height="600" style="border:solid 1px #404040;"></canvas>
</div>
</div>
<script>
let tile = null;
let cnt_tiles=0;
let touch_item=null;
let last_rot=0;
let last_zoom=Math.sqrt(1.860986476636446);
const SCALE = 230;
const OFFSET_X = 120;
const OFFSET_Y = 100;
const CENTER_X = OFFSET_X/SCALE;
const CENTER_Y = OFFSET_Y/SCALE;
const BGSIZE = 12;
let penColor = '#001280';
let tileColor = '#ffffff';
let paints = [];
function setup() {
  bodyMovePrevent();
  treatDownloadButton();
  paper.setup(canvas_draw);
  paper.view.zoom = SCALE;
  paper.view.center =(new paper.Point(CENTER_X,CENTER_Y));

  clearPaint();
  let tool = new paper.Tool();
  let paint = null;
  let toBeRemoved = null;
  tool.onMouseDown = e=> {
    paint = new paper.Path();
    if (e.item) {
      touch_item = e.item;
      if (!/^(tile|bg)$/.test(e.item.name)) {
        toBeRemoved = e.item;
        cnt_tiles--;
        if (cnt_tiles===0) {
          clearPaint();
        } 
      }
    }
    paint.name = 'paint';
    paint.strokeColor = penColor;
    paint.strokeWidth = 0.1;
    paint.add(e.point);
  }
  tool.onMouseDrag  = e=>{
    toBeRemoved = null;
    paint.add(e.point);
    paint.smooth();
  }
  tool.onMouseUp = e=>{
    if (toBeRemoved) {
      toBeRemoved.remove();
    } else {
      paint.add(e.point);
      if (touch_item.name === 'bg' &&
        tile.getIntersections(paint).length===0) {
        paint.remove();
      } else {
        button_download.removeAttribute('disabled');
        button_download.classList.remove('button_disabled');
        cnt_tiles++;
      }
    }
  }
  paper.view.draw();
}
function clearPaint() {
  paper.project.clear();
  (bg=>{
    bg.name = 'bg';
    bg.sendToBack();
    bg.fillColor = penColor;
  })(new paper.Path.Rectangle({
    point: [CENTER_X-BGSIZE/2,CENTER_Y-BGSIZE/2],
    size: [BGSIZE,BGSIZE],
  }));
  tile = new paper.Path();
  tile.name = 'tile';
  tile.closed = true;
  tile.fillColor = tileColor;
  button_download.setAttribute('disabled','');
  button_download.classList.add('button_disabled');
  draw();
}
function draw(){
  const DIFF = 1.01;
  const EPS = 0.5-(1/(1+DIFF));
  let val = parseFloat(input_a.value);
  if (0<=val-0.5 && val-0.5<EPS) {
    val = 0.5+EPS;
  } else if (0<=0.5-val && 0.5-val<EPS) {
    val = 0.5-EPS;
  }
  let a = val;
  let b = 1-val;
  let shape = genShape(a,b);
  tile.removeSegments();
  shape.map(sh=>{
    sh[1] += parseFloat(b);
    tile.add(new paper.Point(sh[1],sh[0]));
  });
  setRotation(tile);
}
function setRotation (dd) {
  let avg = new paper.Point( 
    (dd.segments[2].point.x+dd.segments[7].point.x+dd.segments[11].point.x)/3,
    (dd.segments[2].point.y+dd.segments[7].point.y+dd.segments[11].point.y)/3,
  );
  paper.view.center = avg;
  let rot = 360*parseFloat(input_rot.value);
  let zoom = Math.sqrt(Math.abs(tile.area));
  let diff_rot = rot-last_rot;
  let diff_zoom = last_zoom/zoom;
  paper.view.rotate(diff_rot,avg);
  paper.view.zoom *= diff_zoom;
  last_rot = rot;
  last_zoom = zoom;
}
function setTile(val) {
  input_a.value = val;
  input_a.dispatchEvent(new Event('change'));
}
function treatDownloadButton () {
  if ("ontouchstart" in document.documentElement) {
    button_download.style.display = 'none';
  }
}
function download() {
  if (false) {
    const WIDTH = paper.project.view.viewSize.width;
    const HEIGHT = paper.project.view.viewSize.height;
    let svg = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600 600">
${paper.project.exportSVG().innerHTML}
</svg>`;
    a_download.href = 'data:image/svg+xml,'+encodeURIComponent(svg);
    a_download.download = 'aperiodic.svg';
  } else {
    a_download.href = 'data:image/jpeg' +canvas_draw.toDataURL("image/jpeg", 0.5); 
    a_download.download = 'aperiodic.jpg';
  }
  a_download.click();
}
function bodyMovePrevent() {
  document.addEventListener('touchmove', e => e.preventDefault(), {
    passive: false
  });
  document.addEventListener('mousewheel', e => e.preventDefault(), {
    passive: false
  });
}
function genShape( a, b ) {
  const hr3 = 0.5*Math.sqrt(3.0);
  const base_shape = [
    [0,0], [0,-hr3], [0.5,-hr3], [0.75, -0.5*hr3], [1.5, -hr3],
    [2.25, -0.5*hr3], [2, 0], [2.25, 0.5*hr3], [1.5, hr3], [1.5, 2*hr3],
    [1, 2*hr3], [0.5, hr3], [0.75, 0.5*hr3]
  ];
  const sc1 = a / 0.5;
  const sc2 = b / hr3;
  let ret = [[0,0]];
  for (j=0;j< base_shape.length-1; j++ ) {
    let i = j+1;
    let d = dist( base_shape[i-1], base_shape[i] )
    let sc = sc1;
    if (Math.abs(d-hr3) < 1e-5) {
      sc = sc2;
    }
    let v = [base_shape[i][0]-base_shape[i-1][0],
            base_shape[i][1]-base_shape[i-1][1]]
    p = ret[ret.length-1];
    ret.push( [ p[0]+sc*v[0], p[1]+sc*v[1] ] );
  }
  return ret
}
function dist( p, q ) {
  return Math.sqrt( Math.pow((p[0]-q[0]),2) + Math.pow((p[1]-q[1]),2) );
}
</script>
</body>
</html>
