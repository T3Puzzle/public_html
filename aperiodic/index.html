
<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, height=device-height, initial-scale=0.6, minimum-scale=0.6, maximum-scale=1.0, user-scalable=no" />
<link rel="icon" href="data:;base64,iVBORw0KGgo=">
<style>
 button {
   background-color: yellow;
   color: black;
   text-align: center;
   font-size: 25px;
   margin-left:3px;
 }
 body {
   user-select: none;
   touch-action: none;
   -webkit-user-select: none;
   margin-left:0px;
   margin-right:0px;
   margin-top:5px;
 }
 dd {
   margin-left:10px;
   font-size: 25px;
 }
 div {
   text-align: center;
 }
</style>
</head>
<body onload="setup()">
<div>
<h1>Aperiodic Tile Deformation</h1>
<dd>Shape:<input type="range" id="input_a" value="0.366025" min="0" max="1" step="0.01" onchange="draw()">
 Rotate:<input type="range" id="input_rot" value="0" min="0" max="1" step="0.01" onchange="draw()">
</dd>
<p/>
<button onclick="tile(0.366025)">(1,√3)</button>
<button onclick="tile(0.5)">(1,1)</button>
<button onclick="tile(0.633975)">(√3,1)</button>
<button onclick="download()">SVG download</button>
<a style="display:none;" id="a_download" download="download"></a>
<p/>
<svg width="600" height="500" style="border-style:solid;border-width:1px;border-coloir:black;">
  <g transform="translate(180,160)scale(140)">
  <g id="g_rot" transform="rotate(0,0,0)">
  <path id="path_shape" d="M0 -1 L2 -0.7 L 1 0.7 Z" style="fill:none;stroke:black;stroke-width:0.01" />
  <circle id="circle_2" r="0.03" cx="0" cy="0" fill="red"/>
  <circle id="circle_7" r="0.03" cx="0" cy="0" fill="green"/>
  <circle id="circle_11" r="0.03" cx="0" cy="0" fill="blue"/>
  </g>
  </g>
</svg>
</div>
<script>
function setup() {
  bodyMovePrevent();
  draw();
}
function draw(){
  let val = parseFloat(input_a.value);
  let a = val;
  let b = 1-val;
  let shape = genShape(a,b);
  let d = [];
  let dd = [];
  shape.map(sh=>{
    sh[1] += parseFloat(b);
    d.push(sh[1]+' '+sh[0]);
    dd.push([sh[1],sh[0]]);
  });
  setCircle(circle_2,dd[2]);
  setCircle(circle_7,dd[7]);
  setCircle(circle_11,dd[11]);
  setRotation(dd);
  path_shape.setAttribute('d','M'+d.join('L')+'Z');
}
function setRotation (dd) {
  let rot = 360*parseFloat(input_rot.value);
  let avg = [
    (dd[2][0]+dd[7][0]+dd[11][0])/3,
    (dd[2][1]+dd[7][1]+dd[11][1])/3,
  ];
  g_rot.setAttribute('transform',`rotate(${rot},${avg[0]},${avg[1]})`);
}
function setCircle(circle,yx,fill) {
  circle.setAttribute('cx',yx[0]);
  circle.setAttribute('cy',yx[1]);
  if (fill) {
    circle.setAttribute('fill',fill);
  }
}
function tile(val) {
  input_a.value = val;
  input_a.dispatchEvent(new Event('change'));
}
function download() {
  let svg = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600 800">'
      +path_shape.closest('svg').innerHTML+'</svg>';
  a_download.href = 'data:image/svg+xml,'+encodeURIComponent(svg);
  a_download.click();
}
function bodyMovePrevent() {
  document.addEventListener('touchmove', e => e.preventDefault(), {
    passive: false
  });
  document.addEventListener('mousewheel', e => e.preventDefault(), {
    passive: false
  });
}
function genShape( a, b ) {
  const hr3 = 0.5*Math.sqrt(3.0);
  const base_shape = [
    [0,0], [0,-hr3], [0.5,-hr3], [0.75, -0.5*hr3], [1.5, -hr3],
    [2.25, -0.5*hr3], [2, 0], [2.25, 0.5*hr3], [1.5, hr3], [1.5, 2*hr3],
    [1, 2*hr3], [0.5, hr3], [0.75, 0.5*hr3]
  ];
  const sc1 = a / 0.5;
  const sc2 = b / hr3;
  let ret = [[0,0]];
  for (j=0;j< base_shape.length-1; j++ ) {
    let i = j+1;
    let d = dist( base_shape[i-1], base_shape[i] )
    let sc = sc1;
    if (Math.abs(d-hr3) < 1e-5) {
      sc = sc2;
    }
    let v = [base_shape[i][0]-base_shape[i-1][0],
            base_shape[i][1]-base_shape[i-1][1]]
    p = ret[ret.length-1];
    ret.push( [ p[0]+sc*v[0], p[1]+sc*v[1] ] );
  }
  return ret
}
function dist( p, q ) {
  return Math.sqrt( Math.pow((p[0]-q[0]),2) + Math.pow((p[1]-q[1]),2) );
}
</script>
</body>
</html>
