
<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, height=device-height, initial-scale=0.5, minimum-scale=0.5, maximum-scale=1.0, user-scalable=no" />
<link rel="icon" href="data:;base64,iVBORw0KGgo=">
</head>
<body onload="updateSvg()">
Shape:<input type="range" name="a" value="0.366025" min="0" max="1" step="0.01" onchange="updateSvg()">
Rotate:<input type="range" name="ori" value="0" min="0" max="1" step="0.01" onchange="updateSvg()">
<p/>
<button onclick="tile(0.2)">(1,4)</button>
<button onclick="tile(0.366025)">(1,√3)</button>
<button onclick="tile(0.5)">(1,1)</button>
<button onclick="tile(0.633975)">(√3,1)</button>
<button onclick="tile(0.8)">(4,1)</button>
<button onclick="downloadSvg()">SVG download</button>
<a style="display:none;" id="download" download="download"></a>
<p/>
<svg id="draw" width="600" height="400" style="border-style:solid;border-width:1px;border-coloir:black;">
  <g transform="translate(200,120)scale(120)">
  <g id="rot" transform="rotate(0,0,0)">
  <path id="shape" d="M0 -1 L2 -0.7 L 1 0.7 Z" style="fill:none;stroke:black;stroke-width:0.01" />
  <circle id="c2" r="0.03" cx="0" cy="0" fill="red"/>
  <circle id="c7" r="0.03" cx="0" cy="0" fill="green"/>
  <circle id="c11" r="0.03" cx="0" cy="0" fill="blue"/>
  </g>
  </g>
</svg>
<script>
const path = document.querySelector('svg#draw path#shape');
const s = document.querySelector('svg#draw circle#s');
const t = document.querySelector('svg#draw circle#t');
const u = document.querySelector('svg#draw circle#u');
const rot = document.querySelector('svg#draw g#rot');
const input_a = document.querySelector('input[name="a"]');
const input_ori = document.querySelector('input[name="ori"]');
document.addEventListener('DOMContentLoaded', () => {
  bodyMovePrevent();
});
function updateSvg(){
  let val = parseFloat(input_a.value);
  let a = val;
  let b = 1-val;
  let shape = genShape(a,b);
  let d = [];
  let dd = [];
  shape.map(sh=>{
    sh[1] += parseFloat(b);
    d.push(sh[1]+' '+sh[0]);
    dd.push([sh[1],sh[0]]);
  });
  setCircle(c2,dd[2]);
  setCircle(c7,dd[7]);
  setCircle(c11,dd[11]);
  setRotation(dd);
  path.setAttribute('d','M'+d.join('L')+'Z');
}
function setRotation (dd) {
  let ori = 360*parseFloat(input_ori.value);
  let avg = [
    (dd[2][0]+dd[7][0]+dd[11][0])/3,
    (dd[2][1]+dd[7][1]+dd[11][1])/3,
  ];
  rot.setAttribute('transform',`rotate(${ori},${avg[0]},${avg[1]})`);
}
function setCircle(circle,yx,fill) {
  circle.setAttribute('cx',yx[0]);
  circle.setAttribute('cy',yx[1]);
  if (fill) {
    circle.setAttribute('fill',fill);
  }
}
function tile(val) {
  input_a.value = val;
  input_a.dispatchEvent(new Event('change'));
}
function downloadSvg() {
  let svg = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600 800">'
      +path.closest('svg').innerHTML+'</svg>';
  let anchor = document.querySelector('a#download');
  anchor.href = 'data:image/svg+xml,'+encodeURIComponent(svg);
  anchor.click();
}
function bodyMovePrevent() {
  document.addEventListener('touchmove', e => e.preventDefault(), {
    passive: false
  });
  document.addEventListener('mousewheel', e => e.preventDefault(), {
    passive: false
  });
}
function genShape( a, b ) {
  const hr3 = 0.5*Math.sqrt(3.0);
  const base_shape = [
    [0,0], [0,-hr3], [0.5,-hr3], [0.75, -0.5*hr3], [1.5, -hr3],
    [2.25, -0.5*hr3], [2, 0], [2.25, 0.5*hr3], [1.5, hr3], [1.5, 2*hr3],
    [1, 2*hr3], [0.5, hr3], [0.75, 0.5*hr3]
  ];
  const sc1 = a / 0.5;
  const sc2 = b / hr3;
  let ret = [[0,0]];
  for (j=0;j< base_shape.length-1; j++ ) {
    let i = j+1;
    let d = dist( base_shape[i-1], base_shape[i] )
    let sc = sc1;
    if (Math.abs(d-hr3) < 1e-5) {
      sc = sc2;
    }
    let v = [base_shape[i][0]-base_shape[i-1][0],
            base_shape[i][1]-base_shape[i-1][1]]
    p = ret[ret.length-1];
    ret.push( [ p[0]+sc*v[0], p[1]+sc*v[1] ] );
  }
  return ret
}
function dist( p, q ) {
  return Math.sqrt( Math.pow((p[0]-q[0]),2) + Math.pow((p[1]-q[1]),2) );
}
</script>
</body>
</html>
