<!DOCTYPE html>
<html>
<head>
    <title>SVG Manipulation with Multitouch</title>
    <style>
        #mySVG {
            border: 1px solid black;
        }
    </style>
</head>
<body>
    <svg id="mySVG" width="500" height="500">
        <rect id="myRect" x="150" y="150" width="200" height="200" fill="green" />
    </svg>

    <script>
        var svg = document.getElementById('mySVG');
        var rect = document.getElementById('myRect');

        var initialDistance = 0;
        var initialAngle = 0;
        var initialScale = 1;
        var initialX = 0;
        var initialY = 0;

        svg.addEventListener('touchstart', function(event) {
            if (event.touches.length == 2) {
                var dx = event.touches[1].pageX - event.touches[0].pageX;
                var dy = event.touches[1].pageY - event.touches[0].pageY;
                initialDistance = Math.sqrt(dx * dx + dy * dy);
                initialAngle = Math.atan2(dy, dx);
                initialX = (event.touches[0].pageX + event.touches[1].pageX) / 2;
                initialY = (event.touches[0].pageY + event.touches[1].pageY) / 2;
                console.log('touchstart: initialDistance = ' + initialDistance + ', initialAngle = ' + initialAngle);
            }
        });

        svg.addEventListener('touchmove', function(event) {
            if (event.touches.length == 2) {
                event.preventDefault();

                var xCenter = (event.touches[0].pageX + event.touches[1].pageX) / 2;
                var yCenter = (event.touches[0].pageY + event.touches[1].pageY) / 2;

                var dx = event.touches[1].pageX - event.touches[0].pageX;
                var dy = event.touches[1].pageY - event.touches[0].pageY;
                var distance = Math.sqrt(dx * dx + dy * dy);
                var angle = Math.atan2(dy, dx);

                var scale = distance / initialDistance;
                var rotate = (angle - initialAngle) * 180 / Math.PI;

                rect.setAttribute('transform', 'translate(' + (xCenter - initialX) + ' ' + (yCenter - initialY) + ') scale(' + scale + ') rotate(' + rotate + ', ' + initialX + ', ' + initialY + ')');
                console.log('touchmove: xCenter = ' + xCenter + ', yCenter = ' + yCenter + ', scale = ' + scale + ', rotate = ' + rotate);
            }
        });

        svg.addEventListener('touchend', function(event) {
            if (event.touches.length == 1) {
                initialDistance = 0;
                initialAngle = 0;
                console.log('touchend: reset initialDistance and initialAngle');
            }
        });
    </script>
</body>
</html>
