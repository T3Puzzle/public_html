<!DOCTYPE html>
<html>
<head>
    <title>SVG Manipulation with Multitouch</title>
    <style>
        #mySVG {
            border: 1px solid black;
        }
    </style>
</head>
<body>
    <svg id="h_svg" width="100%" height="100%">
      <g id="s_g0">
	<g id="s_g1">
          <rect x="150" y="150" width="200" height="200" fill="green" />
	</g>
      </g>
      <rect id="s_marker" x="0" y="0" width="20" height="20" fill="black" />
    </svg>
    <script>
h_svg.setAttribute('width', window.innerWidth);
h_svg.setAttribute('height', window.innerHeight);
let offset={r:0,s:1};
h_svg.addEventListener('touchstart', function(e) {
  if (e.touches.length === 2) {
    const u = update(e,s_g0,null);
    offset.r = u.r;
    offset.s = u.s;
    const m = s_g1.getCTM();
    s_g1.setAttribute('matrix',`matrix(${m.a},${m.b},${m.c},${m.d},${m.e-u.cx},${m.f-u.cy})`);
    s_g0.setAttribute('transform',`translate(${u.cx},${u.cy})scale(1)rotate(0);
    s_m.setAttribute('fill','red');
  }
});
h_svg.addEventListener('touchmove', function(e) {
  e.preDefault();
  if (e.touches.length === 2) {
    const u=update(e,s_g0,offset);
    s_g0.setAttribute('transform',`translate(${u.cx},${u.cy})scale(${u.s})rotate(${u.r})`);
    s_marker.setAttribute('transform',`translate(${cx},${cy}) scale(${scale}) rotate(${rotate})`);
  }
});
h_svg.addEventListener('touchend', function(e) {
  if (e.touches.length === 1) {
    offset.r = 0;
    offset.s = 1;
    let m = s_g1.getCTM();
    s_g0.setAttribute('transform',`matrix(${m.a},${m.b},${m.c},${m.d},${m.e},${m.f})`);
    s_g1.setAttribute('transform',`matrix(1,0,0,1,0,0)`);
    s_marker.setAttribute('fill','black');
  }
});
function update(e,s_g0,offset) {
  const cx=(e.touches[0].pageX+e.touches[1].pageX)/2;
  const cy=(e.touches[0].pageY+e.touches[1].pageY)/2;
  let or=0;
  let os=1;
  if (offset) {
    or=offset.r;
    os=offset.s;
  }
  const dx=e.touches[1].pageX-e.touches[0].pageX;
  const dy=e.touches[1].pageY-e.touches[0].pageY;
  const r=Math.atan2(dy,dx)*180/Math.PI - or;
  const s=Math.sqrt(dx*dx+dy*dy)/os;
  return {cx:cx,cy:cy,dx:dx,dy:dy,s:s,r:r};
}
/*
function mul(m1, m2) {
    return {
        a: m1.a * m2.a + m1.b * m2.c,
        b: m1.a * m2.b + m1.b * m2.d,
        c: m1.c * m2.a + m1.d * m2.c,
        d: m1.c * m2.b + m1.d * m2.d,
        e: m1.e * m2.a + m1.f * m2.c + m2.e,
        f: m1.e * m2.b + m1.f * m2.d + m2.f
    };
}
function inv(m) {
    const det = m.a * m.d - m.b * m.c;
    return {
        a: m.d / det,
        b: -m.b / det,
        c: -m.c / det,
        d: m.a / det,
        e: (m.c * m.f - m.d * m.e) / det,
        f: (m.b * m.e - m.a * m.f) / det
    };
}
function mat(x, y, r, s) {
  const rad = r * (Math.PI / 180);
  return {
    a: s * Math.cos(rad),
    b: s * Math.sin(rad),
    c: -s * Math.sin(rad),
    d: s * Math.cos(rad),
    e: x,
    f: y
  };
}
*/
</script>
</body>
</html>
