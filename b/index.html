
<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<link rel="icon" href="data:;base64,iVBORw0KGgo=">
<script src="jscheck.js"></script>
<style>body {
  background:rgb(200,200,200);
  user-select: none;
  touch-action: none;
  -webkit-user-select: none;
}
body.move {
  background:rgb(175, 175, 175);
}
div.menu {
  position: absolute;
  top: 0px;
  padding-left: 1em;
  z-index: 5;
}
</style>
</head>
<body>


  <script>
  let APP = {
    name: 't3p',
    type: 'gridpuzzle'
  };
  APP.restored = localStorage.getItem(APP.name+'__DATA__LASTMODIFIED');
  </script>
<div class="menu">
  <switch-text onchange="t3puzzle.setAttribute('color',this.value)" value="blue" size="40px">
    <datalist>
      <option value="blue"></option>
      <option value="green"></option>
      <option value="pink"></option>
      <option value="mint"></option>
    </datalist>
  </switch-text>
  <button-text text="‚û∞" onclick="t3puzzle.setAttribute('flipall','');" size="40px">
  </button-text>

  <button-text text="‚åñ" onclick="t3puzzle.setAttribute('fit','');" size="40px">
  </button-text>

  <button-text text="‚§ø" onclick="rotate();" size="40px" class="ui__pc">
  </button-text>

  <button-text text="‚Üë‚éµ" onclick="dialogopen(
                                  'upload',
                                  dialog__form__modal,
                                  dialog__t3work, 
                                  dialog__form,
                                  UPLOAD)" size="40px">
  </button-text>
  <button-text text="üìñ" onclick="dialogopen(
                                  'load',
                                  load__form__modal,
                                  load__t3work, 
                                  load__form,
                                  LOAD)" size="40px">
  </button-text>
</div>
<grid-puzzle style="margin-left:0px;" id="t3puzzle" xmode="hand" onChange="processData(this.value)" xonclick="window.setTimeout(()=>{t3puzzle.setAttribute('mode','hand');
document.body.classList.remove('move');},500);">
  <datalist>
    <grid-data>{
      "orientation":2.094388031086739,
      "tiles":[[0,0,0,0,0,0,0],[0,0,1,0,0,0,0],
      [1,0,0,0,0,0,0],[1,0,1,0,0,0,0],[2,0,1,2,1,0,0]]}
    </grid-data>
  </datalist>
</grid-puzzle>

<dialog-modal id="dialog__form__modal">
  <template>
    <div id="dialog__src" style="width:320px;height:320px; background: rgb(200, 200, 200);"></div>
    <grid-puzzle style="margin-left:0px;" id="dialog__t3work" width="320px" height="320px" mode="readonly" for="dialog__src">
      <datalist>
        <grid-data>{"tiles":[]}
        </grid-data>
      </datalist>
    </grid-puzzle>
    <div style="width:100%;height:90%;margin: 3px;text-align: center;">
      <div class="ui__pc">
        <button-text text="‚§ø" onclick="rotate(dialog__t3work);" size="20px">
        </button-text>
        
        <button-text text="üîç" onclick="zoom(dialog__t3work);" size="20px">
        </button-text>
        
        <button-text text="‚åñ" onclick="dialog__t3work.setAttribute('fit','');" size="20px">
        </button-text>
      </div>
      <form id="dialog__form" action="#" style="text-align:left;" onsubmit="submitImage(dialog__src,dialog__dst,dialog__form, UPLOAD);return false;">
        <input name="artist" type="hidden">
        <input name="data" type="hidden">
        <input name="filename" type="hidden">
        <input name="type" value="image/png" type="hidden">
        <input name="content" type="hidden">
        <label for="dialog__age">„Å≠„Çì„Çå„ÅÑ:</label>
        <input required id="dialog__age" name="age" type="number" min="0" max="150" style="width:35px;">
        <div style="display:inline-block;margin-top:10px;border-width:1px;">
          <input type="submit" value="„Åª„Åû„Çì„Åô„Çã" style="background:#4676FF;-webkit-appearance: none;color:white;border-radius: 5px;border-width:0px;font-size:110%;">
        </div>
        <br />
        <input required placeholder="„Å†„ÅÑ„ÇÅ„ÅÑ" name="title" type="text" style="width:305px;margin-top:3px;border-width:1px;" onchange="UPLOAD.title = this.value;">
        <textarea placeholder="„É°„É¢" name="note" rows="4" onchange="UPLOAD.note = this.value;" style="width:305px;margin-top:3px;display:block;font-size:95%;border-width:1px;"></textarea>
      </form>
      <div id="dialog__dst" style="display:none;">
      </div>
  </template>
</dialog-modal>

<dialog-modal id="load__form__modal">
  <template>
    <div id="load__src" style="width:320px;height:320px; background: rgb(200, 200, 200);"></div>
    <grid-puzzle style="margin-left:0px;" id="load__t3work" width="320px" height="320px" mode="readonly" for="load__src">
      <datalist>
        <grid-data>{"tiles":[]}
        </grid-data>
      </datalist>
    </grid-puzzle>
    <div style="width:100%;height:90%;margin: 0px;text-align: center;">

    </div>
    <form id="load__form" action="#" style="text-align:left;" onsubmit="loadDataToMain(load__form__modal);return false;">
      <input name="artist" type="hidden">
      <input name="data" type="hidden">
      <input name="filename" type="hidden">
      <input name="type" value="image/png" type="hidden">
      <input name="content" type="hidden">
      <input id="load__age" name="age" type="hidden" min="0" max="150" style="width:35px;">
      <div style="display:inline-block;border-width:1px;">
        
        <button-text text="¬´" onclick="gohead(load__t3work,load__form);" size="30px">
        </button-text>
        <button-text text="‚Äπ" onclick="backward(load__t3work,load__form);" size="30px">
        </button-text>
        <div id="load__number" style="display:inline-block;"></div>
        
        <button-text text="‚Ä∫" onclick="forward(load__t3work,load__form);" size="30px">
        </button-text>
        <button-text text="¬ª" onclick="goend(load__t3work,load__form);" size="30px">
        </button-text>
        <input type="submit" value="„Åì„Çå„Çí„Å§„Åã„ÅÜ" style="background:#46cc76;-webkit-appearance: none;color:white;border-radius: 5px;border-width:0px;font-size:110%;display:inline-block;">
      </div>
      <br />
      <input readonly placeholder="„Å†„ÅÑ„ÇÅ„ÅÑ" name="title" type="text" style="width:305px;margin-top:3px;border-width:1px;">
      <textarea readonly placeholder="„É°„É¢" name="note" rows="4" style="width:305px;margin-top:3px;display:block;font-size:95%;border-width:1px;"></textarea>
    </form>
    <div id="load__dst" style="display:none;">
    </div>
  </template>
</dialog-modal>

</div>
<script>
  let HISTORY = {
    status: '',
  };
  function loadInitData(){
     let str = APP.restored;
    if (str) {
      t3puzzle.setAttribute('loaddata',str);
    }
  }
  document.addEventListener('DOMContentLoaded', () => {
    loadInitData();
    bodyMovePrevent();
    if (('ontouchend' in document)) {
      Array.from(document.querySelectorAll('.ui__pc')).map(u => {
        u.style['display'] = 'none';
      });
    }
    
    loadPreset();
  });
  let UPLOAD = {
    imageNode: null,
    lastImageNode: null,
    submitMessage: '',
    submitEvent: '',
    title: '',
    note:'',
    url: 'https://script.google.com/a/tessellation.jp/macros/s/AKfycbzNfVfpZuYhGT6XZ_0ElgV0ASYb2_Th1qOOjvBWUWssEPBGm3fM/exec'
  }
  let LOAD = {
    imageNode: null,
    lastImageNode: null,
    submitMessage: '',
    submitEvent: '',
    url: UPLOAD.url,
    pointer: null,
    preset: 0,
  }
  function loadPreset() {
    let count=-1;
  
    localStorage.setItem(APP.name+'__MIN',count);
    localStorage.setItem(APP.name+'__DATA__'+count,JSON.stringify({'orientation':3.1415855821521044,'tiles':[[2,0,0,1,0,0,0],[2,0,1,1,1,0,0],[2,1,0,0,1,0,0],[1,1,0,0,1,0,0],[2,1,1,0,0,0,0],[2,-1,1,1,1,0,0],[2,-1,0,1,0,0,0],[1,-1,0,1,1,0,0],[1,-1,1,1,0,0,0],[1,0,1,1,0,0,0],[1,0,0,1,1,0,0],[1,1,1,0,0,0,0],[0,1,0,1,0,0,0],[0,1,1,0,0,0,0],[-1,1,0,0,1,0,0],[-1,0,1,1,1,0,0],[-1,0,0,0,1,0,0],[-1,-1,1,1,1,0,0],[-1,-1,0,0,1,0,0],[0,-1,0,1,0,0,0],[0,-1,1,0,0,0,0],[0,0,0,1,0,0,0],[0,0,1,0,0,0,0],[-1,1,1,0,0,0,0]],'time':1632810891609,'title':'T3','note':'T3„Éë„Ç∫„É´„ÅÆ„É≠„Ç¥„Çí„Å§„Åè„Çä„Åæ„Åó„Åü'})); 
       ///
    count--; 
    localStorage.setItem(APP.name+'__MIN',count);
    localStorage.setItem(APP.name+'__DATA__'+count,JSON.stringify({'orientation':-2.0944014018871053,'tiles':[[2,0,0,0,1,2,0],[2,0,1,1,1,2,0],[2,-1,1,2,1,2,0],[2,-1,0,1,1,2,0],[1,-1,0,0,1,2,0],[1,-1,1,2,1,2,0],[1,0,0,1,1,2,0],[2,1,0,1,0,2,0],[1,0,1,1,0,2,0],[1,-2,0,1,0,2,0],[2,-2,1,1,0,2,0],[1,-2,1,1,1,2,0],[2,2,0,2,0,2,0],[2,1,1,2,1,2,0],[1,1,0,0,1,2,0],[1,1,1,0,0,2,0],[0,-3,0,2,1,2,0],[1,-3,1,0,1,2,0],[2,-3,1,2,0,2,0],[2,-2,0,2,1,2,0],[1,-3,0,0,0,2,0],[0,-4,1,1,1,2,0],[3,-2,1,0,1,2,0],[3,-2,0,1,1,2,0],[3,0,1,2,1,2,0],[3,1,0,1,1,2,0],[0,-1,0,0,1,2,0],[0,-1,1,1,1,2,0],[0,-2,0,2,1,2,0],[3,-1,1,0,1,2,0],[3,-1,0,0,0,2,0],[0,-3,1,2,0,2,0]],'time':1632811156995,'title':'„Ç´„Éñ„Éà„É†„Ç∑','note':'„Å™„Å§„ÇÑ„Åô„Åø„ÅÆ„Åä„ÇÇ„ÅÑ„Åß„Åß„Ç´„Éñ„Éà„É†„Ç∑„Çí„Åã„Åç„Åæ„Åó„Åü'})); 
       ///
    count--;
    localStorage.setItem(APP.name+'__MIN',count);
    localStorage.setItem(APP.name+'__DATA__'+count,JSON.stringify({'orientation':-2.0944014018871053,'tiles':[[2,0,0,0,1,2,0],[2,0,1,0,0,2,0],[2,-1,1,1,1,2,0],[2,-1,0,1,0,2,0],[1,-1,1,0,1,2,0],[1,0,0,0,1,2,0],[1,0,1,1,1,2,0],[1,1,1,0,0,2,0],[1,-3,0,0,0,2,0],[3,0,1,0,0,2,0],[0,-1,0,1,1,2,0],[0,-1,1,0,1,2,0],[4,0,0,2,1,2,0],[3,0,0,0,1,2,0],[4,0,1,0,0,2,0],[2,-2,1,1,1,2,0],[2,-2,0,1,0,2,0],[2,-3,1,2,0,2,0],[1,-1,0,2,1,2,0],[0,0,0,0,1,2,0],[1,1,0,1,0,2,0],[0,1,0,0,1,2,0],[0,0,1,2,0,2,0],[-1,0,0,0,0,2,0],[0,-2,1,1,0,2,0],[0,-2,0,0,0,2,0],[1,-2,1,2,0,2,0]],'time':1632811454266,'title':'„É©„Ç∏„Ç™‰ΩìÊìç','note':'Â§è‰ºë„Åø„Å´„É©„Ç∏„Ç™‰ΩìÊìç„Çí„Åó„ÅüÊÄù„ÅÑÂá∫„Çí„Åã„Åç„Åæ„Åó„Åü'})); 
       ///
    count--;
    localStorage.setItem(APP.name+'__MIN',count);
    localStorage.setItem(APP.name+'__DATA__'+count,JSON.stringify({'orientation':-2.094400778962728,'tiles':[[2,0,0,0,0,1,0],[2,-1,1,0,1,1,0],[2,-1,0,0,0,1,0],[1,-1,0,0,0,1,0],[1,-1,1,1,0,1,0],[1,0,0,1,1,1,0],[2,1,0,1,1,1,0],[1,0,1,1,0,1,0],[2,2,0,0,1,1,0],[2,1,1,2,1,1,0],[1,1,0,2,0,1,0],[3,0,1,0,0,1,0],[3,1,0,1,0,1,0],[3,-1,1,2,0,1,0],[3,2,1,2,1,1,0],[2,0,1,0,1,1,0],[3,1,1,2,1,1,0],[3,2,0,0,1,1,0],[3,3,0,2,0,1,0],[4,3,1,0,0,1,0],[4,2,1,1,1,1,0],[4,3,0,0,1,1,0],[5,3,1,0,0,1,0],[5,3,0,1,0,1,0],[4,2,0,1,0,1,0],[5,2,1,1,1,1,0],[5,2,0,1,0,1,0],[5,1,1,2,0,1,0],[4,1,0,2,1,1,0],[4,1,1,0,0,1,0],[4,0,1,2,0,1,0],[3,0,0,2,1,1,0],[4,0,0,1,1,1,0],[5,0,1,2,1,1,0],[5,1,0,2,0,1,0],[4,-1,1,2,1,1,0],[3,-1,0,2,0,1,0],[3,-2,1,1,0,1,0],[6,1,1,0,0,1,0],[6,1,0,0,1,1,0],[3,-2,0,1,1,1,0],[4,-2,1,0,1,1,0],[5,-2,1,1,0,1,0],[4,-2,0,0,0,1,0],[4,-1,0,1,1,1,0],[5,0,0,0,1,1,0],[5,-1,1,2,1,1,0],[3,-3,0,0,0,1,0],[3,-3,1,1,0,1,0],[4,-3,1,0,1,1,0],[6,0,1,1,1,1,0],[7,1,1,0,0,1,0],[7,1,0,1,0,1,0],[7,0,1,1,1,1,0],[7,0,0,1,0,1,0],[7,-1,1,2,0,1,0],[6,-1,0,2,1,1,0],[6,-2,1,2,0,1,0],[5,-2,0,2,1,1,0],[5,-3,1,2,0,1,0],[4,-3,0,0,0,1,0],[5,-1,0,0,0,1,0],[6,-1,1,1,0,1,0],[6,0,0,1,0,1,0],[1,1,1,2,0,1,0],[1,2,0,2,1,1,0],[2,2,1,2,0,1,0],[2,3,0,2,1,1,0],[3,3,1,2,0,1,0],[3,4,0,1,0,1,0],[3,4,1,1,1,1,0],[3,5,0,1,0,1,0],[0,1,0,0,0,1,0],[-1,1,0,0,0,1,0],[0,1,1,0,1,1,0],[2,3,1,1,0,1,0],[1,2,1,1,0,1,0],[2,4,0,1,0,1,0],[1,3,0,0,0,1,0],[0,2,0,0,0,1,0],[-1,1,1,1,0,1,0],[2,5,0,0,1,1,0],[3,5,1,0,0,1,0],[2,5,1,0,0,1,0],[-1,2,0,1,1,1,0],[-1,2,1,1,0,1,0],[-1,3,0,2,0,1,0],[0,3,1,2,1,1,0],[0,4,0,1,1,1,0],[1,4,1,2,1,1,0],[1,5,0,2,0,1,0],[0,3,0,1,1,1,0],[0,2,1,0,1,1,0],[1,4,0,0,1,1,0],[1,3,1,2,1,1,0],[2,4,1,1,1,1,0]],'time':1632812255904,'title':'„Ç∏„É£„ÉÉ„ÇØ„Ç™„Éº„É©„É≥„Çø„É≥','note':'„Åì„Å®„Åó„ÇÇ„ÇÇ„ÅÜ„Åô„Åê„Éè„É≠„Ç¶„Ç£„Éº„É≥ÔºÅ'})); 
       ///
    count--;

    localStorage.setItem(APP.name+'__MIN',count);
    localStorage.setItem(APP.name+'__DATA__'+count,JSON.stringify({'orientation':0.5235896368295516,'tiles':[[0,0,0,1,1,0,1],[1,0,0,2,1,0,1],[1,0,1,1,0,0,1],[2,0,1,0,1,0,1],[1,-1,1,0,1,0,1],[0,-1,0,0,0,0,1],[0,-1,1,1,1,0,1],[-1,-1,0,1,1,0,1],[0,1,1,1,1,0,1],[-1,1,0,1,1,0,1],[0,2,1,1,1,0,1],[-1,2,0,1,0,0,1],[2,2,1,0,1,0,1],[0,3,1,1,1,0,1],[-1,3,0,0,1,0,1],[1,2,0,0,0,0,1],[2,3,1,0,1,0,1],[1,3,0,2,0,0,1],[2,4,1,2,1,0,1],[1,4,0,2,1,0,1],[0,4,1,1,1,0,1],[-1,4,0,0,0,0,1],[2,5,1,2,1,0,1],[1,5,0,0,1,0,1]],'time':1632794863529,'title':'„Å≤„Åó„Å™„Çâ„Åπ','note':'T3„Éë„Ç∫„É´„Çí„Å§„Åã„Å£„Åü„ÅÇ„Åù„Å≥„Åß„Åô\n„ÅÜ„Åà„ÅÆ„Çà„ÅÜ„Å™„Åä„Åä„Åç„Å™„Å≤„Åó„Åå„Åü„Çí„Å§„Åè„Çä„Åæ„Åó„Çá„ÅÜ„ÄÇ„Åü„Å†„Åó„ÄÅ„Åó„Åü„ÅÆÔºò„Å§„ÅÆ„Å°„ÅÑ„Åï„Å™„Å≤„Åó„Åå„Åü„Çí„Åµ„Åè„ÇÄ„Åì„Å®'}));
   ///
    count--;

    localStorage.setItem(APP.name+'__MIN',count);
    localStorage.setItem(APP.name+'__DATA__'+count,JSON.stringify({'orientation':0.52359196882172,'tiles':[[0,0,0,1,0,0,1],[1,0,0,0,0,0,1],[2,0,1,1,0,0,1],[0,-1,0,2,0,0,1],[0,-1,1,2,0,0,1],[-1,-1,0,2,0,0,1],[0,1,1,1,0,0,1],[-1,1,0,1,0,0,1],[0,2,1,1,0,0,1],[-1,2,0,1,1,0,1],[2,2,1,2,0,0,1],[0,3,1,1,0,0,1],[-1,3,0,0,1,0,1],[1,2,0,2,1,0,1],[2,3,1,2,0,0,1],[1,3,0,0,1,0,1],[2,4,1,2,0,0,1],[1,4,0,2,0,0,1],[0,4,1,1,0,0,1],[-1,4,0,0,0,0,1],[2,5,1,2,0,0,1],[1,5,0,0,0,0,1],[1,-1,1,2,1,0,2],[1,0,1,1,1,0,2]],'time':1632794566502,'title':'„Å≤„Åó„Å™„Çâ„Åπ(„ÅÆ„Åì„ÇäÔºí„Éî„Éº„Çπ)','note':'T3„Éë„Ç∫„É´„Çí„Å§„Åã„Å£„Åü„ÅÇ„Åù„Å≥„Åß„Åô\n„Åó„Åü„ÅÆÔºò„Å§„ÅÆ„Å°„ÅÑ„Åï„Å™„Å≤„Åó„Åå„Åü„Çí„Åµ„Åè„ÇÄ„Çà„ÅÜ„Å´„ÄÅ„ÅÜ„Åà„ÅÆ„Åä„Åä„Åç„Å™„Å≤„Åó„Åå„Åü„Çí„Åã„Çì„Åõ„ÅÑ„Åï„Åõ„Çà„ÅÜ'}));
    
    
   ///
    count--;

    localStorage.setItem(APP.name+'__MIN',count);
    localStorage.setItem(APP.name+'__DATA__'+count,JSON.stringify({'orientation':-2.094401552186574,'tiles':[[0,0,0,2,0,0,1],[1,0,0,0,0,0,1],[1,0,1,0,0,0,1],[2,0,1,2,1,0,1],[1,-1,1,2,0,0,1],[0,-1,0,0,0,0,1],[0,-1,1,0,0,0,1],[-1,-1,0,2,1,0,1],[3,-2,1,1,0,0,1],[4,-2,1,1,0,0,1],[3,-2,0,1,0,0,1],[3,-3,1,1,0,0,1],[2,-3,0,0,1,0,1],[2,-2,0,0,1,0,2],[2,-3,1,2,1,0,2],[1,-3,0,0,1,0,2]],'time':1632805212985,'title':'„Åæ„Çä„Çá„ÅÜ„Åò„ÇìÔºàÈ≠îËè±Èô£Ôºâ','note':'„ÅÜ„Åà„ÅÆ„Çà„ÅÜ„Å™„Äå„Å≤„Åó„Åå„Åü„Äç„Çí„Å§„Åè„Çã„Éë„Ç∫„É´„Åß„Åô„ÄÇ\n„Å≤„Åó„Åå„Åü„Çí4√ó4„ÅÆ„Éû„Çπ„É°„Åß„Åè„Åé„Å£„Å¶„Åã„Çì„Åå„Åà„Å¶„ÄÅ\n„Å©„ÅÆ„Åé„Çá„ÅÜ„ÄÅ„Çå„Å§„Å´„ÇÇ„ÅÇ„Åä„ÅÑ„Äå„Åï„Çì„Åã„Åè„Åë„ÅÑ„Äç„Çí\nÔºì„Å§„Åä„Åè„Çà„ÅÜ„Å´„Å™„Çâ„Åπ„Å¶„Åè„Å†„Åï„ÅÑ'})); 
    ///
    count--;

    localStorage.setItem(APP.name+'__MIN',count);
    localStorage.setItem(APP.name+'__DATA__'+count,JSON.stringify({'orientation':-2.094403274190408,'tiles':[[2,-2,1,1,0,0,1],[1,-2,1,0,0,0,1],[1,-2,0,1,1,0,1],[1,-3,1,2,0,0,1],[0,-2,0,2,1,0,1],[0,-3,1,2,1,0,1],[0,-3,0,2,0,0,1],[0,-4,1,1,1,0,1],[-1,-4,1,0,1,0,1],[-1,-4,0,1,0,0,1],[-1,-3,0,0,0,0,1],[-2,-4,0,0,1,0,1],[3,-3,1,0,1,0,1],[2,-4,1,1,1,0,1],[1,-5,1,2,0,0,1],[0,-6,1,0,0,0,1],[-1,-7,1,1,0,0,1],[4,-2,1,2,1,0,1],[4,-3,0,2,1,0,1],[3,-4,0,1,1,0,1],[2,-5,0,0,1,0,1],[1,-6,0,2,0,0,1],[0,-7,0,1,0,0,1],[-1,-8,0,0,0,0,1]],'time':1632806379048,'title':'„ÉÅ„Çß„ÉÉ„Ç´„Éº„Å™„Çâ„Åπ','note':'„ÅÜ„Åà„ÅÆ„Çà„ÅÜ„Å™„Äå„Åó„Åã„Åè„Äç„Å´„Å™„Çâ„Åπ„Çã„Éë„Ç∫„É´„Åß„Åô„ÄÇ\n‰∏ã„ÅÆ12„Éî„Éº„Çπ„ÅÆ„ÇÄ„Åç„Çí„Åã„Åà„Åö„Å´„ÄÅ„Å®„Å™„Çä„ÅÇ„ÅÜ„Éî„Éº„Çπ„Å®„ÅÑ„Çç„Åå„Å∂„Å§„Åã„Çâ„Å™„ÅÑ„Çà„ÅÜ„Å´„Äå„ÉÅ„Çß„ÉÉ„Ç´„Éº„ÇÇ„Çà„ÅÜ„Äç„ÅÆ„Çà„ÅÜ„Å´„Å™„Çâ„Åπ„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ'}));
     ///
    count--;

    localStorage.setItem(APP.name+'__MIN',count);
    localStorage.setItem(APP.name+'__DATA__'+count,JSON.stringify({'orientation':-2.094403274190408,'tiles':[[2,-2,1,1,1,0,1],[1,-2,0,1,0,0,1],[1,-3,1,1,0,0,1],[0,-2,0,0,1,0,1],[0,-3,1,0,0,0,1],[0,-3,0,1,1,0,1],[-1,-4,1,2,1,0,1],[-1,-4,0,2,0,0,1],[3,-3,1,0,1,0,1],[2,-4,1,1,1,0,1],[1,-5,1,2,0,0,1],[0,-6,1,0,0,0,1],[-1,-7,1,1,0,0,1],[4,-2,1,2,1,0,1],[4,-3,0,2,1,0,1],[3,-4,0,1,1,0,1],[2,-5,0,0,1,0,1],[1,-6,0,2,0,0,1],[0,-7,0,1,0,0,1],[-1,-8,0,0,0,0,1],[1,-2,1,0,0,0,2],[-1,-3,0,2,0,0,2],[0,-4,1,2,1,0,2],[-2,-4,0,2,0,0,2]],'time':1632807872117,'title':'„ÉÅ„Çß„ÉÉ„Ç´„Éº„Å™„Çâ„ÅπÔºà„ÅÆ„Åì„Çä4„Éî„Éº„ÇπÔºâ','note':'„ÅÜ„Åà„ÅÆ„Äå„Åó„Åã„Åè„Äç„ÅÆ„ÅÇ„Åä„ÅÑ„ÅÆ„Éî„Éº„Çπ„Çí„Å™„Çâ„Å≥„Åã„Åà„Å¶„ÄÅ„Å®„Å™„Çä„ÅÇ„ÅÜ„Éî„Éº„Çπ„Å®„ÅÑ„Çç„Åå„Å∂„Å§„Åã„Å™„Çâ„ÅÑ„Çà„ÅÜ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ„Åü„Å†„Åó„ÄÅ„ÅÜ„Åà„ÅÆ„Éî„Éº„Çπ„ÅØ„Å©„Çå„ÇÇ„ÄÅ„Åó„Åü„ÅÆ12„Éî„Éº„Çπ„ÅÆ„ÅÑ„Åö„Çå„Åã„Å≤„Å®„Å§„Å®„Åä„Å™„Åò„ÇÄ„Åç„Å®„Åó„Åæ„Åô„ÄÇ'}));
     ///
    count--;

    localStorage.setItem(APP.name+'__MIN',count);
    localStorage.setItem(APP.name+'__DATA__'+count,JSON.stringify({'orientation':-2.094402963852356,'tiles':[[2,-2,1,2,0,0,1],[1,-2,0,2,1,0,2],[1,-3,1,2,0,0,2],[0,-2,0,2,1,0,2],[0,-3,1,2,0,0,2],[0,-3,0,2,1,0,2],[-1,-4,1,2,0,0,2],[-1,-4,0,2,1,0,2],[3,-3,1,0,1,0,1],[2,-4,1,1,1,0,1],[1,-5,1,2,0,0,1],[0,-6,1,0,0,0,1],[-1,-7,1,1,0,0,1],[4,-2,1,2,1,0,1],[4,-3,0,2,1,0,1],[3,-4,0,1,1,0,1],[2,-5,0,0,1,0,1],[1,-6,0,2,0,0,1],[0,-7,0,1,0,0,1],[-1,-8,0,0,0,0,1],[1,-2,1,2,0,0,2],[-1,-3,0,2,1,0,2],[0,-4,1,2,0,0,2],[-2,-4,0,2,1,0,1]],'time':1632808558705,'title':'„ÉÅ„Çß„ÉÉ„Ç´„Éº„Å™„Çâ„ÅπÔºà„ÅÆ„Åì„Çä10„Éî„Éº„ÇπÔºâ','note':'„ÅÜ„Åà„ÅÆ„Äå„Åó„Åã„Åè„Äç„ÅÆ„ÅÇ„Åä„ÅÑ„ÅÆ„Éî„Éº„Çπ„Çí„Å™„Çâ„Å≥„Åã„Åà„Å¶„ÄÅ„Å®„Å™„Çä„ÅÇ„ÅÜ„Éî„Éº„Çπ„Å®„ÅÑ„Çç„Åå„Å∂„Å§„Åã„Å™„Çâ„ÅÑ„Çà„ÅÜ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ„Åü„Å†„Åó„ÄÅ„ÅÜ„Åà„ÅÆ„Éî„Éº„Çπ„ÅØ„Å©„Çå„ÇÇ„ÄÅ„Åó„Åü„ÅÆ12„Éî„Éº„Çπ„ÅÆ„ÅÑ„Åö„Çå„Åã„Å≤„Å®„Å§„Å®„Åä„Å™„Åò„ÇÄ„Åç„Å®„Åó„Åæ„Åô„ÄÇ'}));
  }
  function Unlock (jsonStr) {
    let json = JSON.parse(jsonStr);
    json.tiles.map(t=>{
      t[6]=0;
    });
    return JSON.stringify(json);
  }
  function moveMode () {
    document.body.classList.add('move');
   t3puzzle.setAttribute('mode','readonly');
    HISTORY.status = 'move';
  }
  function processData(value) {
    localStorage.setItem('DEBUG', JSON.stringify(
      value.detail.debug));
    let str = JSON.stringify(value.detail.value);
    localStorage.setItem(APP.name + '__DATA__LASTMODIFIED', str);
    HISTORY.status = 'change';
  }
  function dialogopen(action, modal, t3work, form, OBJ) {
    let submit = form.querySelector('input[type=submit]');
    let age = form.querySelector('input[name=age]');
    let filename = form.querySelector('input[name=filename]');
    let artist = form.querySelector('input[name=artist]');
    let title = form.querySelector('input[name=title]');
    let data = form.querySelector('input[name=data]');
    let note = form.querySelector('textarea[name=note]');
    let jsonStr = '';
    if (action === 'load') {
      let {str,i} = loadData(modal);
      jsonStr = str;
      setStrToForm(form, jsonStr,i);
    } else {
      jsonStr = localStorage.getItem(APP.name +
        '__DATA__LASTMODIFIED');
      jsonStr = Unlock(jsonStr);
      markArtist();
      let artistStr = localStorage.getItem(APP.type + '__INFO--ARTIST');
      if (artistStr) {
        artist.value = artistStr;
      }
      let ageStr = localStorage.getItem(APP.type + '__INFO--AGE');
      if (ageStr) {
        age.value = ageStr;
      }
      data.value = jsonStr;
      title.value = UPLOAD.title;
      note.value = UPLOAD.note;
    }
    if (jsonStr) {
      t3work.setAttribute('loaddata', jsonStr);
    }
    if (!OBJ.submitMessage) {
      OBJ.submitMessage = submit.value;
      OBJ.submitEvent = form.getAttribute('onsubmit');
    } else {
      submit.value = OBJ.submitMessage;
      form.setAttribute('onsubmit', OBJ.submitEvent);
      submit.removeAttribute('disabled');
    }
    modal.setAttribute('open', '');
  }

  function loadData(modal) {
    let {min,max} = getCountFromLocal();
    if (min===null) {
      return '';
    }
    let initpointer = max;
    if ( LOAD.pointer !==null) {
      initpointer = LOAD.pointer;
    }
    let {str,i} = loadDataFromLocal(initpointer, false);
    
    LOAD.data = str;
    return {str,i};
  }

  function loadDataToMain(modal, form) {
    t3puzzle.setAttribute('loaddata', LOAD.data);
    modal.setAttribute('close', '');
  }

  function setStrToForm(form, str,idx) {
   „ÄÄ„ÄÄconsole.log(str);
    let title = form.querySelector('input[name=title]');
    let note = form.querySelector('textarea[name=note]');
    title.value = '';
    note.value = '';
    if (str) {
      let json = JSON.parse(str);
      if (json.title) {
        title.value = json.title;
      }
      if (json.note) {
        note.value = json.note;
      }
      let {min,max} = getCountFromLocal();
      let base = max-min+1;
      let now = idx-min+1;
      LOAD.pointer = idx;
      load__number.textContent = (now)+'/'+(base);
    }
  }

  function backward(item, form) {
    let idx = LOAD.pointer;
    let {str,i} = loadDataFromLocal(idx - 1, false);
    goto (item,form,str,i);
  }

  function forward(item, form) {
    let idx = LOAD.pointer;
    let {str,i} = loadDataFromLocal(idx + 1, true);
    goto (item,form,str,i);
  }
  function gohead(item, form) {
    let {min,max} = getCountFromLocal();
    let {str,i} = loadDataFromLocal(min, false);
    goto (item,form,str,i);
  }
  function goend(item, form) {
    let {min,max} = getCountFromLocal();
    let {str,i} = loadDataFromLocal(max, true);
    goto (item,form,str,i);
  }
  function goto (item,form,str,i) {
    if (str) {
      setStrToForm(form, str,i);
      LOAD.data = str;
      item.setAttribute('loaddata', str);
    }
  }
  function loadDataFromLocal(idx, direct) {
    let {min,max} = getCountFromLocal();
    let i = idx;
    let str = '';
    while (min!==null && min <= i && i <= max) {
      str = localStorage.getItem(
        APP.name + '__DATA__' +i);
      if (str) {
        LOAD.pointer = i;
        break;
      }
      if (direct) {
        i++;
      } else {
        i--;
      }
    }
    if (!str) {
      if (direct) {
        LOAD.pointer = max;
      } else {
        LOAD.pointer = min;
      }
    }
    return {str,i};
  }

  function getCountFromLocal() {
    let maxStr = localStorage.getItem(
      APP.name + '__MAX');
    let minStr = localStorage.getItem(
      APP.name + '__MIN');
    let min = null;
    let max = -1;
    if (minStr) {
      min = parseInt(minStr, 10);
    }
    if (maxStr) {
      max = parseInt(maxStr, 10);
    }
    return {min,max};
  }

  function addDataToLocal(form) {
    let data = form.querySelector(
      'input[name=data]').value;
    if (!data) {
      return;
    }
    let title = form.querySelector(
      'input[name=title]').value;
    let note = form.querySelector(
      'textarea[name=note]').value;
    // count up
    let {min,max} = getCountFromLocal();
    let count = max + 1;
    let json = JSON.parse(data);
    json['time'] = Date.now();
    json['title'] = title;
    json['note'] = note;
    localStorage.setItem(
      APP.name + '__DATA__' +
      count, JSON.stringify(json));
    localStorage.setItem(
      APP.name + '__MAX', count);
  }
  function dateNow() {
    return new Intl.DateTimeFormat('ja-JP', {
  year: 'numeric', month: '2-digit', day: '2-digit',
  hour: '2-digit', minute: '2-digit', second: '2-digit',
  hour12: false,
  timeZone: 'Asia/Tokyo'
}).format(new Date()).replace(/[\s\/:]/g,'');
  }
  function submitImage(src, dst, form, OBJ) {
    let submit = form.querySelector('input[type=submit]');
    let age = form.querySelector('input[name=age]');
    let filename = form.querySelector('input[name=filename]');
    let artist = form.querySelector('input[name=artist]');
    let content = form.querySelector('input[name=content]');
    submit.disabled = 'disable';
    submit.value = '„Åª„Åû„Çì„Å°„ÇÖ„ÅÜ';
    addDataToLocal(form);
    localStorage.setItem(APP.type + '__INFO--AGE', age.value);
    saveImage(src, dst, OBJ, () => {
      filename.setAttribute('value',
        artist.value + '__' + dateNow() + '__' + age.value.padStart(3,'0') + '__'+  APP.name +'.png');
      let dst_img = dst.querySelector('img');
      content.setAttribute('value', dst_img.src.split(',')[1]);
      try {
        fetch_upload(form, OBJ,
          (json) => {
            submit.value = '„Å®„Åò„Çã';
            UPLOAD.title = '';
            UPLOAD.note = '';
            submit.removeAttribute('disabled');
            form.setAttribute('onsubmit', 'document.querySelector("#"+this.id+"__modal").setAttribute("close","");return false;');
          }, (e) => {
            submit.value = 'üò®';
          }
        );
      } catch (e) {
        submit.value = 'üò®';
        console.log(e);
      }
    }, () => {
      submit.value = 'ü§î';
    })
  }

  function fetch_upload(form, OBJ, successCallback, errorCallback) {
    const body = new FormData(form);
    fetch(OBJ.url, {
        method: 'POST',
        body: body,
        mode: 'cors',
        redirect: 'follow',
      })
      .then(r => r.json())
      .then(j => {
        if (successCallback) {
          successCallback(j);
        }
      }).catch(e => {
        if (errorCallback) {
          errorCallback(e);
        }
      });
  }

  function saveImage(src, dst, OBJ, successCallback, errorCallback) {
    (async () => {
      try {
        
        OBJ.imageNode = new Image();
        OBJ.imageNode.src = await domtoimage.toPng(src);
        if (OBJ.lastImageNode) {
          dst.removeChild(OBJ.lastImageNode);
        }
        dst.appendChild(OBJ.imageNode);
        OBJ.lastImageNode = OBJ.imageNode;
        successCallback();
      } catch (e) {
        console.log('e::' + e);
        errorCallback();
      }
    })();
  }

  function markArtist() {
    let artist = localStorage.getItem(APP.type + '__INFO--ARTIST');
    if (!artist) {
      localStorage.setItem(APP.type + '__INFO--ARTIST', Math.random().toString(32).substring(2));
    }
  }
  function rotate(_item) {
    let item = _item ? _item : t3puzzle;
    if (!_item) {
      if (HISTORY.status !== 'rotate') {
        item.setAttribute('fit', '');
      }
    }
    item.setAttribute('rotate', Math.PI / 6);
    HISTORY.status = 'rotate';
  }
  function zoom(_item) {
    let item = _item ? _item : t3puzzle;
    item.setAttribute('zoom', 0.9);
  }
  
„ÄÄ„ÄÄ„ÄÄ„ÄÄfunction bodyMovePrevent() {
      
  document.addEventListener('touchmove', e=>e.preventDefault(), { passive: false });
  document.addEventListener('mousewheel', e=>e.preventDefault(), { passive: false });
  }
</script>
<script src="https://www.t3puzzle.com/b/tapspace.min.js"></script>

<script src="https://www.t3puzzle.com/b/dom-to-image.min.js"></script>
<script src="https://www.t3puzzle.com/b/buttonText.js"></script>
<script src="https://www.t3puzzle.com/b/palleteText.js"></script>
<script src="https://www.t3puzzle.com/b/dialog-modal.js"></script>
<script src="https://www.t3puzzle.com/b/switch-text.js"></script>
  
<script src="https://www.t3puzzle.com/a/ghoulog.js"></script>
  
<script src="./t3.js"></script>
<noscript><iframe width="600" height="1000" src="./support.html"></iframe></noscript>
</body>
</html>
