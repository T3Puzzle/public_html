<html>
  <head>
    <meta charset="utf-8">
  </head>
  <body>
    <img-meta src="https://www.t3puzzle.com/b/test_gphoto.png">
    </img-meta>
  <script>
    importModules(
      "./tileUtil.ljs.js",
      "https://codepen.io/alytile/pen/dyRZgga.js?x",
      (mti) => {
        importModules(
          "./t3Util.ljs.js",
          "https://codepen.io/alytile/pen/xxrPQob.js",
          (mt3) => {
            importModules(
              "./tapspace.ljs.min.js",
              "https://codepen.io/alytile/pen/xxxx.js",
              (mtp) => {
                importModules(
                  "./grid-puzzle.ljs.js",
                  "https://codepen.io/alytile/pen/OJjNeEd.js",
                  (mgp) => {
                    mgp.gridPuzzle().define(mti.tileUtil(), mt3.t3Util(),mtp.tapspace);
                  });              
             });
         });
    });

    function importModules(first, second, callback) {
      let ret = null;
      _import(first)
        .then((module) => {
          callback(module);
        })
        .catch((e) => {
          _import(second)
            .then((module) => {
              callback(module);
            })
            .catch((e) => {
              console.log(e);
            });
        });
    }
   function _import(url) {
     return {
       then: (successCallback) => {
         let div = document.createElement("div");
         let script = document.createElement("script");
         script.setAttribute("src", url);
         script.addEventListener("load",()=>
           successCallback(
             JSON.parse(script.getAttribute("x-module"),(k,v)=>(typeof v==="string"&&v.match(/^function/))?Function.call(this,'return '+v)():v)
           )
         );
         return { 
           catch: (errorCallback) => {
             script.addEventListener("error", errorCallback);
             document.head.appendChild(div);
             div.appendChild(script);
           }
         }
       }
     }
   }
  </script>
  </body>
</html>
