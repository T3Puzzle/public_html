<html>
  <head>
    <meta charset="utf-8">
  </head>
  <body>
    <img-meta src="https://www.t3puzzle.com/b/test_gphoto.png">
    </img-meta>
  <script>
    importModules(
      "../buffer.ljs.js",
      "https://www.t3puzzle.com/n/buffer.ljs.js",
      (mbf) => {
                importModules(
                  "../img-meta.ljs.js",
                  "https://www.t3puzzle.com/n/img-meta.js",
                  (mim) => {
                    mim.imageMeta(mbf.buffer);
                });
    });

    function importModules(first, second, callback) {
      let ret = null;
      _import(first)
        .then((module) => {
          callback(module);
        })
        .catch((e) => {
          _import(second)
            .then((module) => {
              callback(module);
            })
            .catch((e) => {
              console.log(e);
            });
        });
    }
   function _import(url) {
     return {
       then: (successCallback) => {
         let div = document.createElement("div");
         let script = document.createElement("script");
         script.setAttribute("src", url);
         script.addEventListener("load",()=>
           successCallback(
             JSON.parse(script.getAttribute("x-module"),(k,v)=>(typeof v==="string"&&v.match(/^function/))?Function.call(this,'return '+v)():v)
           )
         );
         return { 
           catch: (errorCallback) => {
             script.addEventListener("error", errorCallback);
             document.head.appendChild(div);
             div.appendChild(script);
           }
         }
       }
     }
   }
  </script>
  </body>
</html>
